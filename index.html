<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zaia's Coupon Book</title>
    <style>
        /* --- Font Import --- */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Dancing+Script:wght@700&family=Lobster&display=swap');

        /* --- Base Styles & Starry Night Theme --- */
        body {
            font-family: 'Poppins', sans-serif;
            color: #EAEAEA;
            margin: 0;
            background: #000; /* Solid black background */
            overflow-x: hidden; /* Prevent horizontal scrollbars */
        }

        /* --- Floral Starfield Background --- */
        #stars, #stars2, #stars3 {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            display: block;
            z-index: 0;
        }

        /* Layer 1: Lighter Pink Flowers */
        #stars {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Cdefs%3E%3Cpattern id='p1' width='300' height='300' patternUnits='userSpaceOnUse'%3E%3Cg fill='%23FFB6C1'%3E%3Ccircle cx='50' cy='50' r='2'/%3E%3Ccircle cx='45' cy='50' r='2'/%3E%3Ccircle cx='55' cy='50' r='2'/%3E%3Ccircle cx='50' cy='45' r='2'/%3E%3Ccircle cx='50' cy='55' r='2'/%3E%3C/g%3E%3Cg fill='%23FFB6C1' opacity='0.5'%3E%3Ccircle cx='150' cy='150' r='1'/%3E%3Ccircle cx='146' cy='150' r='1'/%3E%3Ccircle cx='154' cy='150' r='1'/%3E%3Ccircle cx='150' cy='146' r='1'/%3E%3Ccircle cx='150' cy='154' r='1'/%3E%3C/g%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23p1)'/%3E%3C/svg%3E");
            background-size: 300px 300px;
            animation: move-twink-back 200s linear infinite;
        }

        /* Layer 2: Soft Teal Flowers */
        #stars2 {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Cdefs%3E%3Cpattern id='p2' width='400' height='400' patternUnits='userSpaceOnUse'%3E%3Cg fill='%23B2DFDB'%3E%3Ccircle cx='100' cy='100' r='2'/%3E%3Ccircle cx='95' cy='100' r='2'/%3E%3Ccircle cx='105' cy='100' r='2'/%3E%3Ccircle cx='100' cy='95' r='2'/%3E%3Ccircle cx='100' cy='105' r='2'/%3E%3C/g%3E%3Cg fill='%23B2DFDB' opacity='0.5'%3E%3Ccircle cx='300' cy='300' r='1'/%3E%3Ccircle cx='296' cy='300' r='1'/%3E%3Ccircle cx='304' cy='300' r='1'/%3E%3Ccircle cx='300' cy='296' r='1'/%3E%3Ccircle cx='300' cy='304' r='1'/%3E%3C/g%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23p2)'/%3E%3C/svg%3E");
            background-size: 400px 400px;
            animation: move-twink-back 150s linear infinite;
        }

        /* Layer 3: Sky Blue Flowers */
        #stars3 {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Cdefs%3E%3Cpattern id='p3' width='500' height='500' patternUnits='userSpaceOnUse'%3E%3Cg fill='%2387CEEB'%3E%3Ccircle cx='250' cy='250' r='2'/%3E%3Ccircle cx='245' cy='250' r='2'/%3E%3Ccircle cx='255' cy='250' r='2'/%3E%3Ccircle cx='250' cy='245' r='2'/%3E%3Ccircle cx='250' cy='255' r='2'/%3E%3C/g%3E%3Cg fill='%2387CEEB' opacity='0.5'%3E%3Ccircle cx='50' cy='450' r='1'/%3E%3Ccircle cx='46' cy='450' r='1'/%3E%3Ccircle cx='54' cy='450' r='1'/%3E%3Ccircle cx='50' cy='446' r='1'/%3E%3Ccircle cx='50' cy='454' r='1'/%3E%3C/g%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23p3)'/%3E%3C/svg%3E");
            background-size: 500px 500px;
            animation: move-twink-back 100s linear infinite;
        }
        
        .content-wrapper {
            position: relative;
            z-index: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            font-family: 'Lobster', cursive;
            font-size: 4rem;
            font-weight: 400;
            color: #FFFFFF;
            text-shadow: 0 0 15px rgba(255, 182, 193, 0.7);
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            text-align: center;
        }
        
        h1 span {
            position: relative;
            display: inline-block;
            animation: float 3s ease-in-out infinite;
            animation-delay: var(--delay);
        }

        #coupon-container {
            width: 100%;
            max-width: 600px;
            display: grid;
            gap: 25px;
        }

        /* --- Coupon Card Styling --- */
        .card {
            background: rgba(225, 190, 231, 0.2); /* Soft lavender background */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center; /* Center align items vertically */
            border: 1px solid rgba(225, 190, 231, 0.25); /* Matching border */
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease, transform 0.1s linear; /* Parallax transition */
            position: relative;
            overflow: hidden;
        }

        .card-info {
            flex-grow: 1;
            padding-right: 20px;
        }

        .card-info h2 {
            font-family: 'Dancing Script', cursive;
            margin: 0 0 5px 0;
            font-size: 1.8rem;
            color: #fce4ec; /* Soft pink text */
        }
        
        .card-info .description {
            font-size: 0.8rem;
            color: #e1bee7; /* Soft lavender text */
            margin-top: 10px;
            font-style: italic;
            line-height: 1.4;
            max-width: 350px;
        }

        .card-info p.remaining {
            margin: 10px 0 0 0;
            font-size: 0.9rem;
            color: #f8bbd0; /* Light pink text */
            font-weight: 600;
        }

        /* --- Redeemed State Styling --- */
        .card.redeemed {
            background: rgba(30, 30, 50, 0.5);
        }
        .card.redeemed .card-info h2,
        .card.redeemed .card-info p {
            color: #555;
            text-decoration: line-through;
            text-shadow: none;
        }

        .card.redeemed .btn-container {
            filter: grayscale(80%);
            cursor: not-allowed;
            pointer-events: none;
        }
        
        /* --- Button Styles --- */
        .btn-container {
            width: 180px; 
            height: 55px; 
            position: relative;
            overflow: visible;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .space-btn {
            width: 100%;
            height: 100%;
            position: absolute; 
            overflow: hidden;
            border: 0;
            outline: 0;
            border-radius: 11px;
            background: linear-gradient(80deg, #f8bbd0, #e1bee7, #b3e5fc, #b2dfdb);
            cursor: pointer;
            transition: transform 0.2s ease-out;
        }

        .btn-container::after {
            content: "";
            width: 100%;
            height: 100%;
            position: absolute;
            left: 0;
            top: 15px; 
            z-index: -1;
            background: linear-gradient(80deg, #f8bbd0, #e1bee7, #b3e5fc, #b2dfdb);
            filter: blur(15px);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.15, 0.83, 0.66, 1);
        }

        .btn-container:hover {
            transform: scale(1.1);
            transition: all 0.6s cubic-bezier(0.15, 0.83, 0.66, 1);
        }

        .btn-container:hover::after {
            opacity: 1;
        }

        .btn-container:active {
            transform: scale(1);
        }

        .btn-container:active::after {
            opacity: 0;
        }

        .space-btn span {
            color: #333; 
            font-weight: 700;
            font-size: 16px;
            text-shadow: 0 0 2px rgba(255,255,255,0.5);
        }

        .space-btn .star {
            width: 1px;
            height: 1px;
            background-color: white;
            border-radius: 50%;
            animation: blink 2s cubic-bezier(0.15, 0.83, 0.66, 1) infinite;
            position: absolute;
        }

        .space-btn .shooting-star {
            width: 80px;
            height: 1px;
            position: absolute;
            background: linear-gradient(80deg, #ffffffff, #ffffff00);
            border-radius: 50%;
            transform: rotate(-40deg);
            opacity: 0;
        }

        .space-btn .shooting-star-1 { animation: fallingStar1 4s 6s cubic-bezier(0.15, 0.83, 0.66, 1) infinite; }
        .space-btn .shooting-star-2 { animation: fallingStar2 2s 10s cubic-bezier(0.15, 0.83, 0.66, 1) infinite; }
        
        /* --- Glow Button Styles --- */
        .glowbutton {
         --glow-color: rgb(255, 176, 249);
         --glow-spread-color: rgba(255, 123, 228, 0.781);
         --enhanced-glow-color: rgb(255, 206, 252);
         --btn-color: rgb(136, 61, 125);
         border: 0.25em solid var(--glow-color);
         padding: 1em 2em;
         color: var(--glow-color);
         font-size: 15px;
         font-weight: bold;
         background-color: var(--btn-color);
         border-radius: 1em;
         outline: none;
         box-shadow: 0 0 1em 0.25em var(--glow-color),
           0 0 4em 1em var(--glow-spread-color),
           inset 0 0 0.75em 0.25em var(--glow-color);
         text-shadow: 0 0 0.5em var(--glow-color);
         position: relative;
         transition: all 0.3s;
         cursor: pointer;
        }

        .glowbutton::after {
         pointer-events: none;
         content: "";
         position: absolute;
         top: 120%;
         left: 0;
         height: 100%;
         width: 100%;
         background-color: var(--glow-spread-color);
         filter: blur(2em);
         opacity: 0.7;
         transform: perspective(1.5em) rotateX(35deg) scale(1, 0.6);
        }

        .glowbutton:hover {
         color: var(--btn-color);
         background-color: var(--glow-color);
         box-shadow: 0 0 1em 0.25em var(--glow-color),
           0 0 4em 2em var(--glow-spread-color),
           inset 0 0 0.75em 0.25em var(--glow-color);
        }

        .glowbutton:active {
         box-shadow: 0 0 0.6em 0.25em var(--glow-color),
           0 0 2.5em 2em var(--glow-spread-color),
           inset 0 0 0.5em 0.25em var(--glow-color);
        }
        
        /* --- Animated Border for Special Card --- */
        .animated-border-card::before {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.8); /* Trail color */
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.8), 0 0 10px rgba(255, 255, 255, 0.5);
            animation: trace-border 4s linear infinite;
        }

        /* --- Modal and Notification Styles --- */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 100;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .modal-overlay.visible { opacity: 1; pointer-events: auto; }
        .confirmation-modal {
            background: rgba(225, 190, 231, 0.15); backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px); border-radius: 20px;
            padding: 30px 40px; text-align: center; border: 1px solid rgba(225, 190, 231, 0.2);
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
        }
        .confirmation-modal p { font-size: 1.2rem; font-weight: 600; margin: 0 0 20px 0; }
        .modal-buttons button {
            padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600;
            cursor: pointer; margin: 0 10px; transition: transform 0.2s ease;
        }
        .modal-buttons button:hover { transform: scale(1.05); }
        #confirm-yes { background: #00FF7F; color: #111; }
        #confirm-no { background: #FF1493; color: #fff; }
        #never-mind-btn {
            background: #fca5a5;
            color: #7f1d1d;
        }
        #fight-btn {
            background: #fca5a5;
            color: #7f1d1d;
        }
        #free-head-close-btn, #fight-response-close-btn {
            background: #a78bfa;
            color: #f5f3ff;
            padding: 10px 30px;
        }
        #singing-lessons-close-btn {
            background: #c084fc;
            color: #f5f3ff;
            padding: 10px 30px;
        }
        #notification {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 255, 127, 0.2); backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px); color: #fff; padding: 15px 30px;
            border-radius: 12px; border: 1px solid rgba(0, 255, 127, 0.3);
            font-weight: 600; z-index: 101; opacity: 0;
            transition: opacity 0.5s ease, bottom 0.5s ease; pointer-events: none;
        }
        #notification.visible {
            opacity: 1;
            bottom: 30px;
        }

        /* --- Keyframes for Animations --- */
        @keyframes move-twink-back { from { background-position: 0 0; } to { background-position: -10000px 5000px; } }
        @keyframes titleGlow {
            0% { text-shadow: 0 0 15px #ffb6c1; } 33% { text-shadow: 0 0 15px #b2dfdb; }
            66% { text-shadow: 0 0 15px #87ceeb; } 100% { text-shadow: 0 0 15px #ffb6c1; }
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        @keyframes blink { 0%, 100% { box-shadow: 0 0 10px 0 white; } 50% { box-shadow: 0 0 10px 2px white; } }
        @keyframes fallingStar1 { 0% { top: -10px; left: 220px; opacity: 1; } 100% { top: 200px; left: -20px; opacity: 1; } }
        @keyframes fallingStar2 { 0% { top: -10px; left: 150px; opacity: 1; } 100% { top: 200px; left: -90px; opacity: 1; } }
        @keyframes trace-border {
            0% {
                top: 0;
                left: 0;
                width: 0;
                height: 2px;
            }
            25% {
                top: 0;
                left: 0;
                width: 100%;
                height: 2px;
            }
            25.001% {
                top: 0;
                left: auto;
                right: 0;
                width: 2px;
                height: 0;
            }
            50% {
                top: 0;
                right: 0;
                width: 2px;
                height: 100%;
            }
            50.001% {
                top: auto;
                bottom: 0;
                right: 0;
                width: 0;
                height: 2px;
            }
            75% {
                bottom: 0;
                right: 0;
                width: 100%;
                height: 2px;
            }
            75.001% {
                bottom: 0;
                left: 0;
                right: auto;
                width: 2px;
                height: 0;
            }
            100% {
                bottom: 0;
                left: 0;
                width: 2px;
                height: 100%;
            }
        }

        /* --- Mobile Responsive Styles --- */
        @media (max-width: 600px) {
            .content-wrapper {
                padding: 15px;
            }
            h1 {
                font-size: 2.5rem;
            }
            .card {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            .card-info {
                padding-right: 0;
            }
            .card-info .description {
                max-width: 100%;
            }
            .btn-container {
                width: 150px;
                height: 50px;
            }
            .glowbutton {
                font-size: 14px;
                padding: 0.8em 1.5em;
            }
            .confirmation-modal {
                width: 90%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>

    <div class="content-wrapper">
        <h1 id="main-title"></h1>
        <div id="coupon-container"></div>
    </div>

    <!-- Confirmation Modal -->
    <div id="modal-overlay" class="modal-overlay">
        <div id="confirmation-modal" class="confirmation-modal">
            <p>Are you sure?</p>
            <div class="modal-buttons">
                <button id="confirm-yes">Yes</button>
                <button id="confirm-no">No</button>
            </div>
        </div>
    </div>
    
    <!-- Shut Up Modal -->
    <div id="shut-up-modal-overlay" class="modal-overlay">
        <div id="shut-up-modal" class="confirmation-modal">
            <p>You have some nerve, are you out your right mind, YOU GOT ME FUCKED UP!</p>
            <div class="modal-buttons">
                <button id="never-mind-btn">Never mind</button>
                <button id="fight-btn">Fight</button>
            </div>
        </div>
    </div>
    
    <!-- "That's what I thought" Modal -->
    <div id="thought-modal-overlay" class="modal-overlay">
        <div class="confirmation-modal">
            <p>That's what I thought.</p>
        </div>
    </div>
    
    <!-- Fight Response Modal -->
    <div id="fight-response-modal-overlay" class="modal-overlay">
        <div class="confirmation-modal">
            <p>text the code word "peachy" with a time and location pussycat</p>
            <div class="modal-buttons">
                 <button id="fight-response-close-btn">Okay</button>
            </div>
        </div>
    </div>
    
    <!-- Free Head Modal -->
    <div id="free-head-modal-overlay" class="modal-overlay">
        <div id="free-head-modal" class="confirmation-modal">
            <p>CONGRATULATIONS YOU MADE A BEAUTIFUL CHOICE!</p>
            <p style="font-size: 1rem; font-weight: normal; margin-top: 15px;">Text me a time and place with the code word "peachy".</p>
            <div class="modal-buttons">
                <button id="free-head-close-btn">Awesome</button>
            </div>
        </div>
    </div>
    
    <!-- Singing Lessons Modal -->
    <div id="singing-lessons-modal-overlay" class="modal-overlay">
        <div id="singing-lessons-modal" class="confirmation-modal">
            <p>Yeah, about time you clicked this. I'm glad you came to your senses, I'm going to make you a star!</p>
            <div class="modal-buttons">
                <button id="singing-lessons-close-btn">Let's do it!</button>
            </div>
        </div>
    </div>


    <!-- Notifications -->
    <div id="notification">Redeemed!</div>

    <script>
        // --- Application Logic ---
        const MAX_REDEMPTIONS = 3;
        const couponsData = [
            { id: 'movie-night-pass', title: 'The "Movie Night" Pass', description: "You can choose a really sad, sappy movie. You can choose a really girly movie. You can choose any movie. Or we can make one haha!" },
            { id: 'shut-up-pass', title: 'The "Shut Up" Pass', description: "I will shut the fuck up and stop talking." },
            { id: 'music-session-pass', title: 'The "Shared Music Session" Pass', description: "You get a 60 minute session of us just listening to music, vibing out together. We can take turns adding to a queue or we can listen to a new album just enjoying each other's company." },
            { id: 'glaze-pass', title: 'The "Glaze" Pass', description: "I will give you 5 compliments!" },
            { id: 'free-head-pass', title: '"Free Great Head"', description: "I will be your munch!<br><b>*Infinitely redeemable*</b>" },
            { id: 'quiz-pass', title: 'The "Do a Quiz Together" Pass', description: "I will find a quiz for us to do." },
            { id: 'truth-dare-pass', title: 'The "Truth or Dare" Pass', description: "Give me a truth or dare, and you get to choose which one I have to do." },
            { id: 'singing-lessons-pass', title: 'The "Singing Lessons" Pass', description: "I will teach you my beautiful vocal techniques.<br><em>*Infinitely redeemable*</em>" },
            { id: 'future-plan-pass', title: 'The "Future Plan" Pass', description: "You get to hang out with me once in the future of your choosing." },
            { id: 'lore-drop-pass', title: 'The "Lore Drop" Pass', description: "I will tell you a lore thing about me that you don't know." }
        ];
        const couponContainer = document.getElementById('coupon-container');
        const modalOverlay = document.getElementById('modal-overlay');
        const confirmYesBtn = document.getElementById('confirm-yes');
        const confirmNoBtn = document.getElementById('confirm-no');
        const shutUpModalOverlay = document.getElementById('shut-up-modal-overlay');
        const neverMindBtn = document.getElementById('never-mind-btn');
        const fightBtn = document.getElementById('fight-btn');
        const thoughtModalOverlay = document.getElementById('thought-modal-overlay');
        const fightResponseModalOverlay = document.getElementById('fight-response-modal-overlay');
        const fightResponseCloseBtn = document.getElementById('fight-response-close-btn');
        const freeHeadModalOverlay = document.getElementById('free-head-modal-overlay');
        const freeHeadCloseBtn = document.getElementById('free-head-close-btn');
        const singingLessonsModalOverlay = document.getElementById('singing-lessons-modal-overlay');
        const singingLessonsCloseBtn = document.getElementById('singing-lessons-close-btn');
        const notification = document.getElementById('notification');
        const mainTitle = document.getElementById('main-title');
        let couponToRedeem = null;

        function loadRedeemedState() {
            const state = localStorage.getItem('couponState');
            return state ? JSON.parse(state) : {};
        }

        function saveRedeemedState(state) {
            localStorage.setItem('couponState', JSON.stringify(state));
        }
        
        function showConfirmation(couponId) {
            couponToRedeem = couponId;
            modalOverlay.classList.add('visible');
        }
        
        function showShutUpModal() {
            shutUpModalOverlay.classList.add('visible');
        }
        
        function showFreeHeadModal() {
            freeHeadModalOverlay.classList.add('visible');
            showNotification(); // Show "Redeemed!" right away
        }
        
        function showSingingLessonsModal() {
            singingLessonsModalOverlay.classList.add('visible');
            showNotification();
        }

        function hideConfirmation() {
            couponToRedeem = null;
            modalOverlay.classList.remove('visible');
        }
        
        function hideShutUpModal() {
            shutUpModalOverlay.classList.remove('visible');
        }
        
        function hideFreeHeadModal() {
            freeHeadModalOverlay.classList.remove('visible');
        }
        
        function hideSingingLessonsModal() {
            singingLessonsModalOverlay.classList.remove('visible');
        }
        
        function showNotification() {
            notification.classList.add('visible');
            setTimeout(() => {
                notification.classList.remove('visible');
            }, 2000); 
        }

        function redeemCoupon() {
            if (!couponToRedeem) return;

            let redeemedCounts = loadRedeemedState();
            
            // Special cases for infinitely redeemable coupons
            if (couponToRedeem === 'singing-lessons-pass' || couponToRedeem === 'free-head-pass') {
                 hideConfirmation();
                 showNotification();
                 return; // Don't track count
            }

            let currentCount = redeemedCounts[couponToRedeem] || 0;
            if (currentCount < MAX_REDEMPTIONS) {
                currentCount++;
                redeemedCounts[couponToRedeem] = currentCount;
                saveRedeemedState(redeemedCounts);
                updateCardState(couponToRedeem);
                hideConfirmation();
                showNotification();
            }
        }

        function updateCardState(couponId) {
            if (couponId === 'singing-lessons-pass' || couponId === 'free-head-pass') {
                const card = document.querySelector(`[data-coupon-id="${couponId}"]`);
                if (!card) return;
                const remainingText = card.querySelector('p.remaining');
                remainingText.textContent = 'Can be used anytime!';
                return;
            }

            const redeemedCounts = loadRedeemedState();
            const count = redeemedCounts[couponId] || 0;
            const remaining = MAX_REDEMPTIONS - count;
            const card = document.querySelector(`[data-coupon-id="${couponId}"]`);
            if (!card) return;
            const remainingText = card.querySelector('p.remaining');
            const buttonContainer = card.querySelector('.btn-container');
            const button = buttonContainer.querySelector('button');

            if (remaining <= 0) {
                card.classList.add('redeemed');
                remainingText.textContent = 'Fully Redeemed!';
                
                if (button.classList.contains('glowbutton')) {
                    button.textContent = 'USED';
                } else {
                    const buttonTextSpan = button.querySelector('span');
                    if (buttonTextSpan) buttonTextSpan.textContent = 'USED';
                }

                buttonContainer.onclick = null;
            } else {
                remainingText.textContent = `${remaining} of ${MAX_REDEMPTIONS} uses left`;
            }
        }

        function renderCoupons() {
            couponContainer.innerHTML = '';
            couponsData.forEach(coupon => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.couponId = coupon.id;
                
                let buttonHTML;
                let containerClasses = 'btn-container';

                if (coupon.id === 'free-head-pass') {
                    card.classList.add('animated-border-card');
                    buttonHTML = `<button class="glowbutton">CLAIM NOW!</button>`;
                } else {
                    let starsHTML = '';
                    for (let i = 0; i < 40; i++) {
                        const style = `position: absolute; left: ${Math.random() * 100}%; top: ${Math.random() * 100}%; animation-delay: ${Math.random() * 5}s; transform: scale(${Math.random() * 1.5 + 0.1});`;
                        starsHTML += `<div style="${style}" class="star"></div>`;
                    }
                    starsHTML += `
                        <div style="animation-delay: ${Math.random() * 5}s;" class="shooting-star shooting-star-1"></div>
                        <div style="animation-delay: ${Math.random() * 5 + 5}s;" class="shooting-star shooting-star-2"></div>
                    `;
                    buttonHTML = `<button class="space-btn"><span>REDEEM</span>${starsHTML}</button>`;
                }

                card.innerHTML = `
                    <div class="card-info">
                        <h2>${coupon.title}</h2>
                        <p class="description">${coupon.description}</p>
                        <p class="remaining"></p>
                    </div>
                    <div class="${containerClasses}">
                        ${buttonHTML}
                    </div>
                `;
                const buttonContainer = card.querySelector('.btn-container');
                
                if (coupon.id === 'shut-up-pass') {
                    buttonContainer.onclick = showShutUpModal;
                } else if (coupon.id === 'free-head-pass') {
                    buttonContainer.onclick = showFreeHeadModal;
                } else if (coupon.id === 'singing-lessons-pass') {
                    buttonContainer.onclick = showSingingLessonsModal;
                }
                else {
                    buttonContainer.onclick = () => showConfirmation(coupon.id);
                }
                
                updateCardState(coupon.id);
                
                couponContainer.appendChild(card);
            });
        }
        
        function animateTitle() {
            const titleText = "Zaia's Coupon Book";
            mainTitle.innerHTML = titleText
                .split('')
                .map((char, index) => {
                    const delay = Math.sin(index / 1.5) * 0.4;
                    if (char === ' ') {
                        return `<span style="width: 0.5em;"></span>`;
                    }
                    return `<span style="--delay: ${delay}s">${char}</span>`;
                })
                .join('');
        }
        
        function handleMouseMove(e) {
            const { clientX, clientY } = e;
            const { innerWidth, innerHeight } = window;
            const mouseX = (clientX / innerWidth - 0.5) * 2;
            const mouseY = (clientY / innerHeight - 0.5) * 2;

            const cards = document.querySelectorAll('.card');
            cards.forEach((card, index) => {
                const depth = (index % 4 + 1) * 4;
                const moveX = mouseX * depth;
                const moveY = mouseY * depth;
                card.style.transform = `translate(${moveX}px, ${moveY}px)`;
            });
        }
        
        // Event Listeners
        confirmYesBtn.addEventListener('click', redeemCoupon);
        confirmNoBtn.addEventListener('click', hideConfirmation);
        
        shutUpModalOverlay.addEventListener('click', (e) => {
            if (e.target === shutUpModalOverlay) hideShutUpModal();
        });
        neverMindBtn.addEventListener('click', () => {
            hideShutUpModal();
            thoughtModalOverlay.classList.add('visible');
            setTimeout(() => thoughtModalOverlay.classList.remove('visible'), 2000);
        });
        fightBtn.addEventListener('click', () => {
            hideShutUpModal();
            fightResponseModalOverlay.classList.add('visible');
        });
        fightResponseModalOverlay.addEventListener('click', (e) => {
            if (e.target === fightResponseModalOverlay) fightResponseModalOverlay.classList.remove('visible');
        });
        fightResponseCloseBtn.addEventListener('click', () => fightResponseModalOverlay.classList.remove('visible'));

        freeHeadModalOverlay.addEventListener('click', (e) => {
            if (e.target === freeHeadModalOverlay) hideFreeHeadModal();
        });
        freeHeadCloseBtn.addEventListener('click', hideFreeHeadModal);
        
        singingLessonsModalOverlay.addEventListener('click', (e) => {
            if (e.target === singingLessonsModalOverlay) hideSingingLessonsModal();
        });
        singingLessonsCloseBtn.addEventListener('click', hideSingingLessonsModal);
        
        // Only add mousemove listeners for parallax on non-touch devices
        if (!window.matchMedia("(pointer: coarse)").matches) {
            document.addEventListener('mousemove', handleMouseMove);
        }

        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            animateTitle();
            renderCoupons();
        });
    </script>
</body>
</html>
